# Keycloak Container

This container allows to use `SSO` based authentication.

## Provisioning

It's provisioned by default by the following:

- The user admin: `username=admin`, `password=admin` ;
- A realm `redhat-external` ;
- A client id `dci` ;
- A lambda user within the `redhat-external` realm: `username='dci@redhat.com'`, `password='dci@redhat.com'`

The client id `dci` is configured to allows _OIDC Implicit flow_ and _Direct Access_ protocols.

## Use OIDC Implicit flow

Generate a random value using an `UUID`, then we will use it for the `nonce` field in the following link:

    http://localhost:8180/auth/realms/redhat-external/protocol/openid-connect/auth?\
    client_id=dci-cs&\
    response_type=id_token&\
    scope=openid&\
    nonce=YOU_MUST_REPLACE_ME&\
    redirect_uri=http://localhost:8000/login

This link will redirect the browser to Keycloak `SSO` login page, once authenticated it will redirect to the `redirect_uri` value, _e.g._:

    http://localhost:8000/login?id_token=eyJhs...EPscxhRMuEdA

The `id_token` parameter correspond to the _JSON Web Token_ (`jwt`) generated by Keycloak and will be used to authenticated the client on the server.

## Use Direct Access protocol

From the CLI:

    $ curl \
      --data "client_id=dci-cs" \
      --data "username='dci@redhat.com'" \
      --data "password='dci@redhat.com'" \
      --data "grant_type=password" \
      http://localhost:8180/auth/realms/redhat-external/protocol/openid-connect/token

This will get a `JWT` and will be used to authenticated the client on the server .
