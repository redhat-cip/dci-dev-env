db:
    build: .
    dockerfile: dockerfiles/Dockerfile-DB
    ports:
        - "5432:5432"
dbwatcher:
    build: .
    dockerfile: dockerfiles/Dockerfile-DB-watcher
    links:
      - db
    volumes:
      - .:/mnt/
es:
    build: .
    dockerfile: dockerfiles/Dockerfile-ES
    ports:
        - "9200:9200"
        - "9300:9300"
influxdb:
    build: .
    dockerfile: dockerfiles/Dockerfile-InfluxDB
    ports:
        - "8083:8083"
        - "8086:8086"
grafana:
    build: .
    dockerfile: dockerfiles/Dockerfile-Grafana
    ports:
        - "3000:3000"
api:
    build: .
    dockerfile: dockerfiles/Dockerfile-API
    volumes:
        - ./dci-control-server:/opt/dci-control-server
        - ./settings:/tmp/settings
    links:
        - db
        - es
        - influxdb
        - grafana
    ports:
        - "5000:5000"
    command: python /opt/dci-control-server/scripts/runtestserver.py
tox:
    build: .
    dockerfile: dockerfiles/Dockerfile-TOX
    volumes:
        - ./dci-control-server:/opt/dci/
        - ./python-dciclient:/opt/dci-client/
        - ./settings:/tmp/settings
    links:
        - db
        - es
        - influxdb
    command: /bin/bash
    stdin_open: true
    tty: true
doc:
    build: .
    dockerfile: dockerfiles/Dockerfile-DOC
    volumes:
       - ./dci-doc:/opt/dci-doc/
app:
    build: .
    dockerfile: dockerfiles/Dockerfile-APP
    ports:
        - "8000:8000"
        - "35729:35729"
    volumes:
        - ./dci-ui:/opt/dci-ui
        - /tmp/.X11-unix:/tmp/.X11-unix
    links:
        - api
    environment:
        - DISPLAY
client:
    build: .
    dockerfile: dockerfiles/Dockerfile-CLIENT
    privileged: true
    links:
        - api
    volumes:
        - ./python-dciclient:/opt/python-dciclient/
        - /sys/fs/cgroup:/sys/fs/cgroup:ro
    command: /sbin/init
    stdin_open: true
    tty: true
